(function(x,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],i):(x=typeof globalThis<"u"?globalThis:x||self,i(x["vuejs2-audio-recorder"]={},x.Vue))})(this,function(x,i){"use strict";var N=document.createElement("style");N.textContent=`.icon-button{border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;background-color:transparent}.icon-button svg{height:1.5em;width:1.5em;color:var(--primary-color, #0f6cbd)}.icon-remove svg,.icon-record svg{color:var(--danger-color, #d13438)}.icon-stop svg{color:#333}.wave-container{margin-top:.75em;border:1px solid var(--border-color, rgba(100, 100, 100, .2));border-radius:10em;padding:.5em;width:100%;display:flex;align-items:center;justify-content:center;flex-direction:row-reverse}.wave-container #waveform{flex:1}#waveform{position:relative;background-color:#6464641a;border-radius:10em}.wave-controls{display:flex;align-items:center;justify-content:center}.player-line-control{position:relative;height:4px;border-radius:4px;background-color:#ddd;transition:all .1s ease-in}.player-line-control:hover{height:8px}.player-line-control__head{position:absolute;height:inherit;background-color:var(--primary-color, #0f6cbd);border-radius:inherit}.player-volume{display:flex;align-items:center;line-height:10px}.player-volume-bar{width:50px;border-radius:4px;position:relative;width:0;overflow:hidden}.player-volume__icon{width:24px;height:24px;border:0;border-radius:0;padding:0;background-color:unset;margin-right:3px}.player-volume:hover .player-volume-bar{width:50px}.recorder-player{margin:.5em 0;width:100%;display:flex;align-items:center;justify-content:center}.vue-player{width:100%;height:unset;border:0;display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:unset;border:1px solid var(--border-color, rgba(100, 100, 100, .2));border-radius:10em;padding:.5em;box-sizing:border-box;margin-top:.75em}.vue-player>.vue-player-bar{margin:0 0 0 5px}.vue-player>.vue-player-bar>.vue-player__progress{width:100%}.vue-player-bar{display:flex;align-items:center;height:32px;flex:1}.vue-player-actions{width:55%;display:flex;align-items:center;justify-content:space-around;flex:0}.vue-player__progress{margin:0 .9em}.vue-player__time{white-space:nowrap;color:var(--text-color, #333);font-size:.8em;width:80px}.vue-player__play{width:32px;height:32px}.disabled,*:disabled,div[disabled=true]{opacity:.5;pointer-events:none;cursor:not-allowed;-webkit-user-select:none;user-select:none;border-color:#999!important}figure{margin:0}.recorder-container{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:.75em;margin:.75em}.recorder-container .compact{display:flex}.recorder-action{display:flex;align-items:center;justify-content:center}.recorder-action .vue-recorder-action{width:48px;height:48px;border:1px solid var(--primary-color, #0f6cbd);font-size:18px}.recorder-action .vue-recorder-stop{width:32px;height:32px;margin-left:4px;border:1px solid var(--primary-color, #0f6cbd);font-size:12px}.recorder-message>span{display:block;padding:.5em;border-radius:1em;margin:.5em 0}.recorder-message>span.color-primary{background-color:#b4d6fa}.recorder-message>span.color-success{background-color:#9fd89f}.recorder-message>span.color-danger{background-color:#f4bfab}.vue-records{display:flex;flex-direction:column;width:100%;align-items:center;margin-top:.75em}.vue-records .list-actions{display:flex}.vue-records .list-actions>.icon-button{width:24px;height:24px}.vue-records__record{display:flex;width:100%;justify-content:space-between;padding:.5em;border-radius:2em}.vue-records__record--selected{border:1px solid var(--border-color, rgba(100, 100, 100, .2))}.vue-records__record .icon-button{background-color:transparent}.timing{display:flex;flex-direction:column;align-items:center;justify-content:center}.timing .time-limit,.timing .time-attempt{font-size:.75em}.timing .recorder-timer{margin:0 .25em}.timing .recording-time{text-transform:capitalize}
`,document.head.appendChild(N);class H{constructor(e){this.backendEndpoint=e}async postBackend(e){try{return!!(await fetch(this.backendEndpoint,{method:"POST",body:e})).ok}catch{return!1}}}function v(n){return n?new Date(n*1e3).toISOString().substring(14,19):"00:00"}function L(n,e){const t=e.getBoundingClientRect().width,r=n.target.getBoundingClientRect().left;let s=(n.clientX-r)/t;try{if(!n.target.className.match(/^ar\-line\-control/))return}catch{return}return s=s<0?0:s,s=s>1?1:s,s}class j{constructor(e){this.bufferSize=e.bufferSize||4096,this.sampleRate=e.sampleRate,this.samples=e.samples}finish(){this.joinSamples();const e=new ArrayBuffer(44+this.samples.length*2),t=new DataView(e);this.writeString(t,0,"RIFF"),t.setUint32(4,36+this.samples.length*2,!0),this.writeString(t,8,"WAVE"),this.writeString(t,12,"fmt "),t.setUint32(16,16,!0),t.setUint16(20,1,!0),t.setUint16(22,1,!0),t.setUint32(24,this.sampleRate,!0),t.setUint32(28,this.sampleRate*4,!0),t.setUint16(32,4,!0),t.setUint16(34,16,!0),this.writeString(t,36,"data"),t.setUint32(40,this.samples.length*2,!0),this.floatTo16BitPCM(t,44,this.samples);const r=new Blob([t],{type:"audio/wav"});return{id:Date.now(),blob:r,url:URL.createObjectURL(r)}}floatTo16BitPCM(e,t,r){for(let s=0;s<r.length;s++,t+=2){const o=Math.max(-1,Math.min(1,r[s]));e.setInt16(t,o<0?o*32768:o*32767,!0)}}joinSamples(){const e=this.samples.length*this.bufferSize,t=new Float64Array(e);let r=0;for(let s=0;s<this.samples.length;s++){const o=this.samples[s];t.set(o,r),r+=o.length}this.samples=t}writeString(e,t,r){for(let s=0;s<r.length;s++)e.setUint8(t+s,r.charCodeAt(s))}}class F{constructor(e={}){this.beforeRecording=e.beforeRecording,this.pauseRecording=e.pauseRecording,this.afterRecording=e.afterRecording,this.micFailed=e.micFailed,this.encoderOptions={bitRate:e.bitRate,sampleRate:e.sampleRate},this.bufferSize=4096,this.records=[],this.isPause=!1,this.isRecording=!1,this.duration=0,this.volume=0,this.wavSamples=[],this.waveDuration=0}start(){const e={video:!1,audio:{channelCount:1,echoCancellation:!1}};this.beforeRecording&&this.beforeRecording("start recording"),navigator.mediaDevices.getUserMedia(e).then(this.micCaptured.bind(this)).catch(this.micError.bind(this)),this.isPause=!1,this.isRecording=!0}stop(){if(!this.stream||this.context.state=="closed")return;this.stream.getTracks().forEach(r=>r.stop()),this.input.disconnect(),this.processor.disconnect(),this.context.close();const t=new j({bufferSize:this.bufferSize,sampleRate:this.encoderOptions.sampleRate,samples:this.wavSamples}).finish();this.wavSamples=[],t.duration=v(this.duration),this.records.push(t),this.waveDuration=0,this.duration=0,this.isPause=!1,this.isRecording=!1,this.afterRecording&&this.afterRecording(t)}pause(){this.stream.getTracks().forEach(e=>e.stop()),this.input.disconnect(),this.processor.disconnect(),this.waveDuration=this.duration,this.isPause=!0,this.pauseRecording&&this.pauseRecording("pause recording")}recordList(){return this.records}lastRecord(){return this.records.slice(-1).pop()}micCaptured(e){this.context=new(window.AudioContext||window.webkitAudioContext),this.duration=this.waveDuration,this.input=this.context.createMediaStreamSource(e),this.processor=this.context.createScriptProcessor(this.bufferSize,1,1),this.stream=e,this.processor.onaudioprocess=t=>{const r=t.inputBuffer.getChannelData(0);let s=0;this.wavSamples.push(new Float32Array(r));for(let o=0;o<r.length;++o)s+=r[o]*r[o];this.duration=parseFloat(this.waveDuration)+parseFloat(this.context.currentTime.toFixed(2)),this.volume=Math.sqrt(s/r.length).toFixed(2)},this.input.connect(this.processor),this.processor.connect(this.context.destination)}micError(e){this.micFailed&&this.micFailed(e)}}const Fe="",k=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},G={name:"IconButton",props:{name:{type:String}},data(){return{icons:{download:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M3.5 13h9a.5.5 0 0 1 .09.992L12.5 14h-9a.5.5 0 0 1-.09-.992L3.5 13h9h-9ZM7.91 1.008L8 1a.5.5 0 0 1 .492.41l.008.09v8.792l2.682-2.681a.5.5 0 0 1 .638-.058l.07.058a.5.5 0 0 1 .057.638l-.058.069l-3.535 3.536a.5.5 0 0 1-.638.057l-.07-.057l-3.535-3.536a.5.5 0 0 1 .638-.765l.069.058L7.5 10.292V1.5a.5.5 0 0 1 .41-.492L8 1l-.09.008Z"/></svg>',upload:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M3.5 2a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9Zm4.854 2.146a.5.5 0 0 0-.708 0l-3.5 3.5a.5.5 0 1 0 .708.708L7.5 5.707V13.5a.5.5 0 0 0 1 0V5.707l2.646 2.647a.5.5 0 0 0 .708-.708l-3.5-3.5Z"/></svg>',mic:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M5.5 4.5a2.5 2.5 0 0 1 5 0V8a2.5 2.5 0 0 1-5 0V4.5ZM8 3a1.5 1.5 0 0 0-1.5 1.5V8a1.5 1.5 0 1 0 3 0V4.5A1.5 1.5 0 0 0 8 3ZM4 7.5a.5.5 0 0 1 .5.5a3.5 3.5 0 1 0 7 0a.5.5 0 0 1 1 0a4.5 4.5 0 0 1-4 4.473V13.5a.5.5 0 0 1-1 0v-1.027A4.5 4.5 0 0 1 3.5 8a.5.5 0 0 1 .5-.5Z"/></svg>',pause:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M3.75 2A1.75 1.75 0 0 0 2 3.75v8.5c0 .966.784 1.75 1.75 1.75h1.5A1.75 1.75 0 0 0 7 12.25v-8.5A1.75 1.75 0 0 0 5.25 2h-1.5ZM3 3.75A.75.75 0 0 1 3.75 3h1.5a.75.75 0 0 1 .75.75v8.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-8.5ZM10.75 2A1.75 1.75 0 0 0 9 3.75v8.5c0 .966.784 1.75 1.75 1.75h1.5A1.75 1.75 0 0 0 14 12.25v-8.5A1.75 1.75 0 0 0 12.25 2h-1.5ZM10 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v8.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-8.5Z"/></svg>',play:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M5.745 3.064A.5.5 0 0 0 5 3.5v9a.5.5 0 0 0 .745.436l8-4.5a.5.5 0 0 0 0-.871l-8-4.5ZM4 3.5a1.5 1.5 0 0 1 2.235-1.307l8 4.5a1.5 1.5 0 0 1 0 2.615l-8 4.5A1.5 1.5 0 0 1 4 12.5v-9Z"/></svg>',save:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M4 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1V9.5A1.5 1.5 0 0 1 5.5 8h5A1.5 1.5 0 0 1 12 9.5V13a1 1 0 0 0 1-1V5.621a1 1 0 0 0-.293-.707l-1.621-1.621A1 1 0 0 0 10.379 3H10v1.5A1.5 1.5 0 0 1 8.5 6h-2A1.5 1.5 0 0 1 5 4.5V3H4Zm2 0v1.5a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5V3H6Zm5 10V9.5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0-.5.5V13h6ZM2 4a2 2 0 0 1 2-2h6.379a2 2 0 0 1 1.414.586l1.621 1.621A2 2 0 0 1 14 5.621V12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4Z"/></svg>',stop:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M12.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h9Zm-9-1A1.5 1.5 0 0 0 2 3.5v9A1.5 1.5 0 0 0 3.5 14h9a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 12.5 2h-9Z"/></svg>',volume:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path d="M8.694 2.04A.5.5 0 0 1 9 2.5v11a.5.5 0 0 1-.85.357l-2.927-2.875H3.5a1.5 1.5 0 0 1-1.5-1.5v-2.99a1.5 1.5 0 0 1 1.5-1.5h1.724l2.927-2.85a.5.5 0 0 1 .543-.103zm3.043 1.02l.087.058l.098.085c.063.056.15.138.252.245c.206.213.476.527.746.938a6.542 6.542 0 0 1 1.083 3.618a6.522 6.522 0 0 1-1.083 3.614c-.27.41-.541.724-.746.936l-.142.141l-.187.17l-.033.026a.5.5 0 0 1-.688-.72l.13-.117a5.49 5.49 0 0 0 .83-.985c.46-.7.919-1.73.919-3.065a5.542 5.542 0 0 0-.919-3.069a5.588 5.588 0 0 0-.54-.698l-.17-.176l-.184-.17a.5.5 0 0 1 .547-.832zM8 3.684L5.776 5.851a.5.5 0 0 1-.349.142H3.5a.5.5 0 0 0-.5.5v2.989a.5.5 0 0 0 .5.5h1.927a.5.5 0 0 1 .35.143L8 12.308V3.685zm2.738 1.374l.1.07l.133.126l.054.056c.114.123.26.302.405.54c.292.48.574 1.193.574 2.148c0 .954-.282 1.668-.573 2.148a3.388 3.388 0 0 1-.405.541l-.102.105l-.07.065l-.04.033l-.063.03c-.133.052-.442.139-.64-.108a.5.5 0 0 1 .012-.638l.134-.129l.034-.036c.075-.08.179-.208.284-.382c.21-.345.429-.882.429-1.63c0-.747-.219-1.283-.428-1.627a2.467 2.467 0 0 0-.223-.311l-.095-.105l-.069-.065a.5.5 0 0 1 .55-.83z" fill="currentColor" fill-rule="nonzero"/></svg>',volumeMute:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M8.694 2.04A.5.5 0 0 1 9 2.5v11a.5.5 0 0 1-.85.357l-2.927-2.875H3.5a1.5 1.5 0 0 1-1.5-1.5v-2.99a1.5 1.5 0 0 1 1.5-1.5h1.724l2.927-2.85a.5.5 0 0 1 .543-.103ZM8 3.684L5.777 5.851a.5.5 0 0 1-.35.142H3.5a.5.5 0 0 0-.5.5v2.989a.5.5 0 0 0 .5.5h1.928a.5.5 0 0 1 .35.143L8 12.308V3.685Zm2.147 2.461a.5.5 0 0 1 .707 0l1.147 1.147l1.146-1.147a.5.5 0 1 1 .707.708L12.708 8l1.146 1.146a.5.5 0 1 1-.707.708L12 8.707l-1.147 1.147a.5.5 0 0 1-.707-.708L11.293 8l-1.146-1.146a.5.5 0 0 1 0-.708Z"/></svg>',record:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8ZM8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1ZM2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8Z"/></svg>',remove:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M7 3h2a1 1 0 0 0-2 0ZM6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1h4Zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0v-5ZM9.5 6a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-1 0v-5a.5.5 0 0 1 .5-.5Zm-4.74 6.703A1.5 1.5 0 0 0 6.246 14h3.508a1.5 1.5 0 0 0 1.487-1.297L12.427 4H3.573l1.187 8.703Z"/></svg>',backward:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M8.354 12.146a.5.5 0 0 1-.708.708l-4.5-4.5a.5.5 0 0 1 0-.708l4.5-4.5a.5.5 0 1 1 .708.708L4.207 8l4.147 4.146Zm4 0a.5.5 0 0 1-.708.708l-4.5-4.5a.5.5 0 0 1 0-.708l4.5-4.5a.5.5 0 0 1 .708.708L8.207 8l4.147 4.146Z"/></svg>',forward:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M7.646 3.854a.5.5 0 1 1 .708-.708l4.5 4.5a.5.5 0 0 1 0 .708l-4.5 4.5a.5.5 0 0 1-.708-.708L11.793 8L7.646 3.854Zm-4 0a.5.5 0 1 1 .708-.708l4.5 4.5a.5.5 0 0 1 0 .708l-4.5 4.5a.5.5 0 0 1-.708-.708L7.793 8L3.646 3.854Z"/></svg>'}}},methods:{onClick(){this.$emit("onClickIcon")}}},q=["innerHTML"];function X(n,e,t,r,s,o){return i.openBlock(),i.createElementBlock("button",{type:"button",class:i.normalizeClass(["icon-button",`icon-${t.name}`]),onClick:e[0]||(e[0]=()=>o.onClick())},[i.createElementVNode("span",{innerHTML:s.icons[t.name]},null,8,q)],2)}const B=k(G,[["render",X]]);function M(n,e,t,r){return new(t||(t=Promise))(function(s,o){function a(h){try{d(r.next(h))}catch(c){o(c)}}function l(h){try{d(r.throw(h))}catch(c){o(c)}}function d(h){var c;h.done?s(h.value):(c=h.value,c instanceof t?c:new t(function(u){u(c)})).then(a,l)}d((r=r.apply(n,e||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;const A={decode:function(n,e){return M(this,void 0,void 0,function*(){const t=new AudioContext({sampleRate:e}),r=t.decodeAudioData(n);return r.finally(()=>t.close()),r})},createBuffer:function(n,e){return typeof n[0]=="number"&&(n=[n]),function(t){const r=t[0];if(r.some(s=>s>1||s<-1)){const s=r.length;let o=0;for(let a=0;a<s;a++){const l=Math.abs(r[a]);l>o&&(o=l)}for(const a of t)for(let l=0;l<s;l++)a[l]/=o}}(n),{duration:e,length:n[0].length,sampleRate:n[0].length/e,numberOfChannels:n.length,getChannelData:t=>n==null?void 0:n[t],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}},Y={fetchBlob:function(n,e,t){var r,s;return M(this,void 0,void 0,function*(){const o=yield fetch(n,t);{const a=(r=o.clone().body)===null||r===void 0?void 0:r.getReader(),l=Number((s=o.headers)===null||s===void 0?void 0:s.get("Content-Length"));let d=0;const h=(c,u)=>M(this,void 0,void 0,function*(){if(c)return;d+=(u==null?void 0:u.length)||0;const g=Math.round(d/l*100);return e(g),a==null?void 0:a.read().then(({done:w,value:m})=>h(w,m))});a==null||a.read().then(({done:c,value:u})=>h(c,u))}return o.blob()})}};class D{constructor(){this.listeners={}}on(e,t){return this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),()=>this.un(e,t)}once(e,t){const r=this.on(e,t),s=this.on(e,()=>{r(),s()});return r}un(e,t){this.listeners[e]&&(t?this.listeners[e].delete(t):delete this.listeners[e])}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(r=>r(...t))}}class $ extends D{constructor(e){super(),e.media?this.media=e.media:this.media=document.createElement("audio"),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),e.playbackRate!=null&&this.onceMediaEvent("canplay",()=>{e.playbackRate!=null&&(this.media.playbackRate=e.playbackRate)})}onMediaEvent(e,t,r){return this.media.addEventListener(e,t,r),()=>this.media.removeEventListener(e,t)}onceMediaEvent(e,t){return this.onMediaEvent(e,t,{once:!0})}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}setSrc(e,t){if(this.getSrc()===e)return;this.revokeSrc();const r=t instanceof Blob?URL.createObjectURL(t):e;this.media.src=r,this.media.load()}destroy(){this.media.pause(),this.revokeSrc(),this.media.src="",this.media.load()}play(){return this.media.play()}pause(){this.media.pause()}isPlaying(){return this.media.currentTime>0&&!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=e}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}setPlaybackRate(e,t){t!=null&&(this.media.preservesPitch=t),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}}class P extends D{constructor(e,t){let r;if(super(),this.timeouts=[],this.isScrolling=!1,this.audioData=null,this.resizeObserver=null,this.isDragging=!1,this.options=e,typeof e.container=="string"?r=document.querySelector(e.container):e.container instanceof HTMLElement&&(r=e.container),!r)throw new Error("Container not found");this.parent=r;const[s,o]=this.initHtml();r.appendChild(s),this.container=s,this.scrollContainer=o.querySelector(".scroll"),this.wrapper=o.querySelector(".wrapper"),this.canvasWrapper=o.querySelector(".canvases"),this.progressWrapper=o.querySelector(".progress"),this.cursor=o.querySelector(".cursor"),t&&o.appendChild(t),this.initEvents()}initEvents(){this.wrapper.addEventListener("click",t=>{const r=this.wrapper.getBoundingClientRect(),s=(t.clientX-r.left)/r.width;this.emit("click",s)}),this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{const{scrollLeft:t,scrollWidth:r,clientWidth:s}=this.scrollContainer,o=t/r,a=(t+s)/r;this.emit("scroll",o,a)});const e=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{e(()=>this.reRender())}),this.resizeObserver.observe(this.scrollContainer)}initDrag(){(function(e,t,r,s,o=5){let a=()=>{};if(!e)return a;const l=d=>{if(d.button===2)return;d.preventDefault(),d.stopPropagation();let h=d.clientX,c=d.clientY,u=!1;const g=f=>{f.preventDefault(),f.stopPropagation();const b=f.clientX,_=f.clientY;if(u||Math.abs(b-h)>=o||Math.abs(_-c)>=o){const{left:E,top:C}=e.getBoundingClientRect();u||(u=!0,r==null||r(h-E,c-C)),t(b-h,_-c,b-E,_-C),h=b,c=_}},w=f=>{u&&(f.preventDefault(),f.stopPropagation())},m=()=>{u&&(s==null||s()),a()};document.addEventListener("pointermove",g),document.addEventListener("pointerup",m),document.addEventListener("pointerleave",m),document.addEventListener("click",w,!0),a=()=>{document.removeEventListener("pointermove",g),document.removeEventListener("pointerup",m),document.removeEventListener("pointerleave",m),setTimeout(()=>{document.removeEventListener("click",w,!0)},10)}};e.addEventListener("pointerdown",l)})(this.wrapper,(e,t,r)=>{this.emit("drag",Math.max(0,Math.min(1,r/this.wrapper.clientWidth)))},()=>this.isDragging=!0,()=>this.isDragging=!1)}getHeight(){return this.options.height==null?128:isNaN(Number(this.options.height))?this.options.height==="auto"&&this.parent.clientHeight||128:Number(this.options.height)}initHtml(){const e=document.createElement("div"),t=e.attachShadow({mode:"open"});return t.innerHTML=`
      <style>
        :host {
          user-select: none;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
          touch-action: none;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight()}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper">
          <div class="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[e,t]}setOptions(e){this.options=e,this.reRender()}getWrapper(){return this.wrapper}getScroll(){return this.scrollContainer.scrollLeft}destroy(){var e;this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect()}createDelay(e=10){const t={};return this.timeouts.push(t),r=>{t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(r,e)}}convertColorValues(e){if(!Array.isArray(e))return e||"";if(e.length<2)return e[0]||"";const t=document.createElement("canvas"),r=t.getContext("2d").createLinearGradient(0,0,0,t.height),s=1/(e.length-1);return e.forEach((o,a)=>{const l=a*s;r.addColorStop(l,o)}),r}renderBars(e,t,r){if(r.fillStyle=this.convertColorValues(t.waveColor),t.renderFunction)return void t.renderFunction(e,r);const s=e[0],o=e[1]||e[0],a=s.length,l=window.devicePixelRatio||1,{width:d,height:h}=r.canvas,c=h/2,u=t.barHeight||1,g=t.barWidth?t.barWidth*l:1,w=t.barGap?t.barGap*l:t.barWidth?g/2:0,m=t.barRadius||0,f=d/(g+w)/a;let b=1;if(t.normalize){b=0;for(let p=0;p<a;p++){const R=Math.abs(s[p]);R>b&&(b=R)}}const _=c/b*u,E=m&&"roundRect"in r?"roundRect":"rect";r.beginPath();let C=0,S=0,y=0;for(let p=0;p<=a;p++){const R=Math.round(p*f);if(R>C){const I=Math.round(S*_),U=I+Math.round(y*_)||1;let T=c-I;t.barAlign==="top"?T=0:t.barAlign==="bottom"&&(T=h-U),r[E](C*(g+w),T,g,U,m),C=R,S=0,y=0}const O=Math.abs(s[p]||0),Z=Math.abs(o[p]||0);O>S&&(S=O),Z>y&&(y=Z)}r.fill(),r.closePath()}renderSingleCanvas(e,t,r,s,o,a,l,d){const h=window.devicePixelRatio||1,c=document.createElement("canvas"),u=e[0].length;c.width=Math.round(r*(a-o)/u),c.height=s*h,c.style.width=`${Math.floor(c.width/h)}px`,c.style.height=`${s}px`,c.style.left=`${Math.floor(o*r/h/u)}px`,l.appendChild(c);const g=c.getContext("2d");this.renderBars(e.map(f=>f.slice(o,a)),t,g);const w=c.cloneNode();d.appendChild(w);const m=w.getContext("2d");c.width>0&&c.height>0&&m.drawImage(c,0,0),m.globalCompositeOperation="source-in",m.fillStyle=this.convertColorValues(t.progressColor),m.fillRect(0,0,c.width,c.height)}renderWaveform(e,t,r){const s=document.createElement("div"),o=this.getHeight();s.style.height=`${o}px`,this.canvasWrapper.style.minHeight=`${o}px`,this.canvasWrapper.appendChild(s);const a=s.cloneNode();this.progressWrapper.appendChild(a);const{scrollLeft:l,scrollWidth:d,clientWidth:h}=this.scrollContainer,c=e[0].length,u=c/d;let g=Math.min(P.MAX_CANVAS_WIDTH,h);if(t.barWidth||t.barGap){const y=t.barWidth||.5,p=y+(t.barGap||y/2);g%p!=0&&(g=Math.floor(g/p)*p)}const w=Math.floor(Math.abs(l)*u),m=Math.floor(w+g*u),f=m-w,b=(y,p)=>{this.renderSingleCanvas(e,t,r,o,Math.max(0,y),Math.min(p,c),s,a)},_=this.createDelay(),E=this.createDelay(),C=(y,p)=>{b(y,p),y>0&&_(()=>{C(y-f,p-f)})},S=(y,p)=>{b(y,p),p<c&&E(()=>{S(y+f,p+f)})};C(w,m),m<c&&S(m,m+f)}render(e){this.timeouts.forEach(l=>l.timeout&&clearTimeout(l.timeout)),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.wrapper.style.width="";const t=window.devicePixelRatio||1,r=this.scrollContainer.clientWidth,s=Math.ceil(e.duration*(this.options.minPxPerSec||0));this.isScrolling=s>r;const o=this.options.fillParent&&!this.isScrolling,a=(o?r:s)*t;if(this.wrapper.style.width=o?"100%":`${s}px`,this.scrollContainer.style.overflowX=this.isScrolling?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.options.splitChannels)for(let l=0;l<e.numberOfChannels;l++){const d=Object.assign(Object.assign({},this.options),this.options.splitChannels[l]);this.renderWaveform([e.getChannelData(l)],d,a)}else{const l=[e.getChannelData(0)];e.numberOfChannels>1&&l.push(e.getChannelData(1)),this.renderWaveform(l,this.options,a)}this.audioData=e,this.emit("render")}reRender(){if(!this.audioData)return;const e=this.progressWrapper.clientWidth;this.render(this.audioData);const t=this.progressWrapper.clientWidth;this.scrollContainer.scrollLeft+=t-e}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e,t=!1){const{clientWidth:r,scrollLeft:s,scrollWidth:o}=this.scrollContainer,a=o*e,l=r/2;if(a>s+(t&&this.options.autoCenter&&!this.isDragging?l:r)||a<s)if(this.options.autoCenter&&!this.isDragging){const d=l/20;a-(s+l)>=d&&a<s+r?this.scrollContainer.scrollLeft+=d:this.scrollContainer.scrollLeft=a-l}else this.isDragging?this.scrollContainer.scrollLeft=a<s?a-10:a-r+10:this.scrollContainer.scrollLeft=a;{const{scrollLeft:d}=this.scrollContainer,h=d/o,c=(d+r)/o;this.emit("scroll",h,c)}}renderProgress(e,t){isNaN(e)||(this.progressWrapper.style.width=100*e+"%",this.cursor.style.left=100*e+"%",this.cursor.style.marginLeft=Math.round(100*e)===100?`-${this.options.cursorWidth}px`:"",this.isScrolling&&this.options.autoScroll&&this.scrollIntoView(e,t))}}P.MAX_CANVAS_WIDTH=4e3;class J extends D{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}const K={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class V extends ${static create(e){return new V(e)}constructor(e){var t,r;super({media:e.media,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.duration=null,this.subscriptions=[],this.options=Object.assign({},K,e),this.timer=new J;const s=e.media?void 0:this.getMediaElement();this.renderer=new P(this.options,s),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const o=this.options.url||((t=this.options.media)===null||t===void 0?void 0:t.currentSrc)||((r=this.options.media)===null||r===void 0?void 0:r.src);o&&this.load(o,this.options.peaks,this.options.duration)}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{const e=this.getCurrentTime();this.renderer.renderProgress(e/this.getDuration(),!0),this.emit("timeupdate",e),this.emit("audioprocess",e)}))}initPlayerEvents(){this.subscriptions.push(this.onMediaEvent("timeupdate",()=>{const e=this.getCurrentTime();this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),this.emit("timeupdate",e)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop()}),this.onMediaEvent("ended",()=>{this.emit("finish")}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",e=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",this.getCurrentTime()),this.emit("click",e))}),this.renderer.on("scroll",(e,t)=>{const r=this.getDuration();this.emit("scroll",e*r,t*r)}),this.renderer.on("render",()=>{this.emit("redraw")}));{let e;this.subscriptions.push(this.renderer.on("drag",t=>{this.options.interact&&(this.renderer.renderProgress(t),clearTimeout(e),e=setTimeout(()=>{this.seekTo(t)},this.isPlaying()?0:200),this.emit("interaction",t*this.getDuration()),this.emit("drag",t))}))}}initPlugins(){var e;!((e=this.options.plugins)===null||e===void 0)&&e.length&&this.options.plugins.forEach(t=>{this.registerPlugin(t)})}setOptions(e){this.options=Object.assign({},this.options,e),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),e.mediaControls!=null&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){return e.init(this),this.plugins.push(e),this.subscriptions.push(e.once("destroy",()=>{this.plugins=this.plugins.filter(t=>t!==e)})),e}getWrapper(){return this.renderer.getWrapper()}getScroll(){return this.renderer.getScroll()}getActivePlugins(){return this.plugins}loadAudio(e,t,r,s){return M(this,void 0,void 0,function*(){if(this.emit("load",e),this.isPlaying()&&this.pause(),this.decodedData=null,this.duration=null,!t&&!r){const o=a=>this.emit("loading",a);t=yield Y.fetchBlob(e,o,this.options.fetchParams)}if(this.setSrc(e,t),this.duration=(yield Promise.resolve(s||this.getDuration()))||(yield new Promise(o=>{this.onceMediaEvent("loadedmetadata",()=>o(this.getDuration()))}))||(yield Promise.resolve(0)),r)this.decodedData=A.createBuffer(r,this.duration);else if(t){const o=yield t.arrayBuffer();this.decodedData=yield A.decode(o,this.options.sampleRate),this.duration!==0&&this.duration!==1/0||(this.duration=this.decodedData.duration)}this.emit("decode",this.duration),this.decodedData&&this.renderer.render(this.decodedData),this.emit("ready",this.duration)})}load(e,t,r){return M(this,void 0,void 0,function*(){this.loadAudio(e,void 0,t,r)})}loadBlob(e,t,r){return M(this,void 0,void 0,function*(){this.loadAudio("blob",e,t,r)})}zoom(e){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks({channels:e=1,maxLength:t=8e3,precision:r=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const s=Math.min(e,this.decodedData.numberOfChannels),o=[];for(let a=0;a<s;a++){const l=this.decodedData.getChannelData(a),d=Math.min(l.length,t),h=l.length/d,c=[];for(let u=0;u<d;u++){const g=l[Math.round(u*h)];c.push(Math.round(g*r)/r)}o.push(c)}return o}getDuration(){return this.duration!==null?this.duration:super.getDuration()}toggleInteraction(e){this.options.interact=e}seekTo(e){const t=this.getDuration()*e;this.setTime(t)}playPause(){return M(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}destroy(){this.emit("destroy"),this.plugins.forEach(e=>e.destroy()),this.subscriptions.forEach(e=>e()),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}const Ge="",Q={name:"AudioVisualizer",components:{IconButton:B},props:{src:{type:String},compact:{type:Boolean,default:!1}},data(){return{wavesurfer:null,muted:!1}},computed:{isReady(){return this.wavesurfer!=null},duration(){return this.isReady?v(this.wavesurfer.getDuration()):v(0)},currentTime(){return this.isReady?v(this.wavesurfer.getCurrentTime()):v(0)},playing(){return this.isReady?this.wavesurfer.isPlaying():!1}},watch:{src:{deep:!0,handler(){this.src&&this.wavesurfer.load(this.src)}}},mounted(){document.createElement("canvas").getContext("2d"),this.wavesurfer=V.create({container:this.$refs.waveform,waveColor:"#0f6cbd",progressColor:"#0e4775",cursorColor:"#666",cursorWidth:1,barWidth:2,barHeight:1,barGap:1,height:32,normalize:!0,hideScrollbar:!0,fillParent:!0})},methods:{setMuted(){this.muted=!this.muted,this.wavesurfer.setMuted(this.muted)}}},ee={class:"wave-container"},te={id:"waveform",ref:"waveform"},ie={class:"wave-controls"};function re(n,e,t,r,s,o){const a=i.resolveComponent("icon-button");return i.openBlock(),i.createElementBlock("div",ee,[i.createElementVNode("div",te,null,512),i.createElementVNode("div",ie,[i.createVNode(a,{name:o.playing?"pause":"play",disabled:!o.isReady,onOnClickIcon:e[0]||(e[0]=()=>s.wavesurfer.playPause())},null,8,["name","disabled"]),i.withDirectives(i.createVNode(a,{name:s.muted?"volumeMute":"volume",disabled:!o.isReady,onOnClickIcon:e[1]||(e[1]=()=>o.setMuted())},null,8,["name","disabled"]),[[i.vShow,!t.compact]]),i.withDirectives(i.createElementVNode("div",{class:"vue-player__time"},i.toDisplayString(o.currentTime)+" / "+i.toDisplayString(o.duration),513),[[i.vShow,!t.compact]])])])}const se=k(Q,[["render",re]]),qe="",oe={name:"LineControl",props:{refId:{type:String},eventName:{type:String},percentage:{type:Number,default:0},rowDirection:{type:Boolean,default:!0}},computed:{calculateSize(){const n=this.percentage<1?this.percentage*100:this.percentage;return`${this.rowDirection?"width":"height"}: ${n}%`}},methods:{onMouseDown(n){const e=L(n,this.$refs[this.refId]);this.$emit("change-linehead",e),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},onMouseUp(n){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove);const e=L(n,this.$refs[this.refId]);this.$emit("change-linehead",e)},onMouseMove(n){if(n.buttons==0)return;const e=L(n,this.$refs[this.refId]);this.$emit("change-linehead",e)}}};function ne(n,e,t,r,s,o){return i.openBlock(),i.createElementBlock("div",{ref:t.refId,class:"player-line-control",onMousedown:e[0]||(e[0]=(...a)=>o.onMouseDown&&o.onMouseDown(...a))},[i.createElementVNode("div",{class:"player-line-control__head",style:i.normalizeStyle(o.calculateSize)},null,4)],544)}const W=k(oe,[["render",ne]]),Xe="",ae={name:"VolumeControl",data(){return{volume:100}},components:{IconButton:B,LineControl:W},methods:{onChangeLinehead(n){this.$emit("change-volume",n),this.volume=n}}},le={class:"player-volume"};function ce(n,e,t,r,s,o){const a=i.resolveComponent("icon-button"),l=i.resolveComponent("line-control");return i.openBlock(),i.createElementBlock("div",le,[i.createVNode(a,{class:"player-volume__icon",name:"volume"}),i.createVNode(l,{class:"player-volume-bar","ref-id":"volume",percentage:s.volume,onChangeLinehead:o.onChangeLinehead},null,8,["percentage","onChangeLinehead"])])}const de=k(ae,[["render",ce]]),Ye="",he={name:"PlayerWidget",components:{IconButton:B,LineControl:W,VolumeControl:de},props:{src:{type:String},compact:{type:Boolean,default:!1}},data(){return{isPlaying:!1,duration:v(0),playedTime:v(0),progress:0}},mounted(){this.player=this.$refs.playerRef,this.player.addEventListener("ended",()=>{this.isPlaying=!1}),this.player.addEventListener("loadeddata",n=>{this.resetProgress(),this.duration=v(this.player.duration)}),this.player.addEventListener("timeupdate",this.onTimeUpdate)},computed:{audioSource(){return this.src?this.src:""},playBtnIcon(){return this.isPlaying?"pause":"play"}},methods:{playback(){this.audioSource&&(this.isPlaying?this.player.pause():setTimeout(()=>{this.player.play()},0),this.isPlaying=!this.isPlaying)},resetProgress(){this.isPlaying&&this.player.pause(),this.duration=v(0),this.playedTime=v(0),this.progress=0,this.isPlaying=!1},onTimeUpdate(){this.playedTime=v(this.player.currentTime),this.progress=this.player.currentTime/this.player.duration*100},onUpdateProgress(n){n&&(this.currentTime=n*this.duration)},onChangeVolume(n){n&&(this.player.volume=n)}}},ue={class:"recorder-player"},pe={class:"vue-player"},me={class:"vue-player-actions"},ge={class:"vue-player-bar"},fe=["src"];function ye(n,e,t,r,s,o){const a=i.resolveComponent("icon-button"),l=i.resolveComponent("line-control"),d=i.resolveComponent("volume-control");return i.openBlock(),i.createElementBlock("div",ue,[i.createElementVNode("div",pe,[i.createElementVNode("div",me,[i.createVNode(a,{id:"play",class:i.normalizeClass(["ar-icon ar-icon__lg vue-player__play",{"vue-player__play--active":s.isPlaying}]),name:o.playBtnIcon,onOnClickIcon:e[0]||(e[0]=()=>o.playback())},null,8,["name","class"])]),i.createElementVNode("div",ge,[i.withDirectives(i.createElementVNode("div",{class:"vue-player__time"},i.toDisplayString(s.playedTime)+" / "+i.toDisplayString(s.duration),513),[[i.vShow,!t.compact]]),i.createVNode(l,{class:"vue-player__progress","ref-id":"progress",percentage:s.progress,onChangeLinehead:o.onUpdateProgress},null,8,["percentage","onChangeLinehead"]),i.createVNode(d,{onChangeVolume:o.onChangeVolume},null,8,["onChangeVolume"])])]),i.createElementVNode("audio",{src:o.audioSource,ref:"playerRef",type:"audio/mpeg"},null,8,fe)])}const ve=k(he,[["render",ye]]),$e="",we={name:"PlayerWidget",components:{AudioVisualizer:se,CustomPlayer:ve},props:{record:{type:Object},src:{type:String},customPlayer:{type:Boolean,default:!1},wavePlayer:{type:Boolean,default:!1},compact:{type:Boolean,default:!1}},data(){return{isPlaying:!1,duration:v(0),playedTime:v(0),progress:0}},computed:{disablePlayer(){return this.objectNullOrEmpty(this.record)&&!this.src},audioSource(){return this.record?this.record.url:this.src?this.src:""}},methods:{objectNullOrEmpty(n){return n?Object.keys(n).length===0:!0}}},be={key:2},_e=["src"],Ce=i.createElementVNode("code",null,"audio",-1);function xe(n,e,t,r,s,o){const a=i.resolveComponent("custom-player"),l=i.resolveComponent("audio-visualizer");return t.customPlayer?(i.openBlock(),i.createBlock(a,{key:0,src:o.audioSource,compact:t.compact,disabled:o.disablePlayer},null,8,["src","compact","disabled"])):t.wavePlayer?(i.openBlock(),i.createBlock(l,{key:1,src:o.audioSource,compact:t.compact,disabled:o.disablePlayer},null,8,["src","compact","disabled"])):(i.openBlock(),i.createElementBlock("figure",be,[i.createElementVNode("audio",{controls:"",src:o.audioSource,ref:"playerRef",type:"audio/mpeg",class:"mx-auto"},[i.createTextVNode(" Your browser does not support the "),Ce,i.createTextVNode(" element. ")],8,_e)]))}const z=k(we,[["render",xe]]),Je="",ke="Failed to use microphone. Please refresh and try again and permit the use of a microphone.",Me="Successfully recorded message!",Se="Failed to save recording! Please try again",Ee={name:"RecorderWidget",components:{IconButton:B,PlayerWidget:z},props:{attempts:{type:Number},time:{type:Number},bitRate:{type:Number,default:128},sampleRate:{type:Number,default:44100},filename:{type:String,default:"audio"},countdownTitle:{type:String,default:"Time remaining"},backendEndpoint:{type:String},showDownloadButton:{type:Boolean,default:!0},showUploadButton:{type:Boolean,default:!0},compact:{type:Boolean,default:!1},customPlayer:{type:Boolean,default:!1},wavePlayer:{type:Boolean,default:!1},countdown:{type:Boolean,default:!1},selectRecordChanged:{type:Function,default:null},customUpload:{type:Function,default:null}},data(){return{recording:!1,recorder:null,successMessage:null,errorMessage:null,recordList:[],selected:{}}},computed:{recordedTime(){var n,e;return this.countdown?v(this.time-((n=this.recorder)==null?void 0:n.duration)):v((e=this.recorder)==null?void 0:e.duration)},attemptsLeft(){return this.attempts-this.recordList.length},iconButtonType(){return this.recording&&this.compact?"stop":this.recording?"record":"mic"}},watch:{"recorder.duration":{deep:!0,handler(){var n;this.time&&((n=this.recorder)==null?void 0:n.duration)>=this.time*1e3&&this.recording&&this.toggleRecording()}}},beforeUnmount(){this.recording&&this.stopRecording()},methods:{toggleRecording(){this.recording?this.stopRecording():this.initRecorder()},initRecorder(){this.recording=!0,this.recorder=new F({micFailed:this.micFailed,bitRate:this.bitRate,sampleRate:this.sampleRate}),this.recorder.start(),this.successMessage=null,this.errorMessage=null,this.service=new H(this.backendEndpoint),this.$emit("beforeRecording")},stopRecording(){this.recording=!1,this.recorder.stop();const n=this.recorder.recordList();this.selected=n[0],this.selected&&this.selected.url?(this.recordList.push(this.selected),this.successMessage=Me,this.$emit("afterRecording",this.selected)):this.errorMessage=Se},async sendData(){this.selected&&this.customUpload(this.selected.blob)},micFailed(){this.recording=!1,this.errorMessage=ke,this.$emit("micFailed")},removeRecord(n){this.recordList.splice(n,1),this.$emit("removeRecord",n)},choiceRecord(n){this.selected!==n&&this.$emit("selectRecordChanged",n)},download(){if(this.selected&&!this.selected.url)return;const n=this.selected.blob.type.split("/")[1],e=document.createElement("a");e.href=this.selected.url,e.download=`${this.filename}.${n}`,e.click()}}},Re={class:"recorder-container"},Be={class:"recorder-action"},Pe={class:"timing"},Le={key:0,class:"time-attempt"},De={class:"recording-time"},Ve={key:0},Te={class:"recorder-timer"},Ne={key:1,class:"time-limit"},Ae={key:0,class:"vue-records"},We=["onClick"],ze={class:"list-actions"},Oe={class:"vue__text"},Ze={key:1,class:"recorder-message"},Ie={key:0,class:"color-success"},Ue={key:1,class:"color-danger"};function He(n,e,t,r,s,o){const a=i.resolveComponent("icon-button"),l=i.resolveComponent("player-widget");return i.openBlock(),i.createElementBlock("div",Re,[i.createElementVNode("div",{class:i.normalizeClass({compact:t.compact})},[i.createElementVNode("div",Be,[i.createVNode(a,{class:"vue-recorder-action",name:o.iconButtonType,disabled:o.attemptsLeft==0,onOnClickIcon:e[0]||(e[0]=()=>o.toggleRecording())},null,8,["name","disabled"]),t.compact?i.createCommentVNode("",!0):(i.openBlock(),i.createBlock(a,{key:0,class:"vue-recorder-stop",name:"stop",disabled:o.attemptsLeft==0||!s.recording,onOnClickIcon:e[1]||(e[1]=()=>o.stopRecording())},null,8,["disabled"]))]),i.createElementVNode("div",Pe,[t.attempts&&!t.compact?(i.openBlock(),i.createElementBlock("div",Le," Attempts: "+i.toDisplayString(o.attemptsLeft)+"/"+i.toDisplayString(t.attempts),1)):i.createCommentVNode("",!0),i.createElementVNode("div",De,[t.countdown?(i.openBlock(),i.createElementBlock("span",Ve,i.toDisplayString(t.countdownTitle),1)):i.createCommentVNode("",!0),i.createElementVNode("span",Te,i.toDisplayString(o.recordedTime),1)]),t.time&&!t.compact?(i.openBlock(),i.createElementBlock("div",Ne," Record duration is limited: "+i.toDisplayString(t.time)+"s ",1)):i.createCommentVNode("",!0)])],2),!t.compact&&s.recordList.length>0?(i.openBlock(),i.createElementBlock("div",Ae,[(i.openBlock(!0),i.createElementBlock(i.Fragment,null,i.renderList(s.recordList,(d,h)=>(i.openBlock(),i.createElementBlock("div",{key:d.id,class:i.normalizeClass(["vue-records__record",{"vue-records__record--selected":d.id===s.selected.id}]),onClick:()=>o.choiceRecord(d)},[i.createElementVNode("span",null,"Record "+i.toDisplayString(h+1),1),i.createElementVNode("div",ze,[d.id===s.selected.id&&t.showDownloadButton?(i.openBlock(),i.createBlock(a,{key:0,id:"download",name:"download",onOnClickIcon:e[2]||(e[2]=()=>o.download())})):i.createCommentVNode("",!0),d.id===s.selected.id&&t.showUploadButton?(i.openBlock(),i.createBlock(a,{key:1,id:"upload",class:"submit-button",name:"upload",onOnClickIcon:e[3]||(e[3]=()=>o.sendData())})):i.createCommentVNode("",!0),d.id===s.selected.id?(i.openBlock(),i.createBlock(a,{key:2,name:"remove",onOnClickIcon:()=>o.removeRecord(h)},null,8,["onOnClickIcon"])):i.createCommentVNode("",!0)]),i.createElementVNode("div",Oe,i.toDisplayString(d.duration),1)],10,We))),128))])):i.createCommentVNode("",!0),i.createVNode(l,{"custom-player":t.customPlayer,wavePlayer:t.wavePlayer,record:s.selected,compact:t.compact},null,8,["custom-player","wavePlayer","record","compact"]),s.successMessage||s.errorMessage?(i.openBlock(),i.createElementBlock("div",Ze,[s.successMessage?(i.openBlock(),i.createElementBlock("span",Ie,i.toDisplayString(s.successMessage),1)):i.createCommentVNode("",!0),s.errorMessage?(i.openBlock(),i.createElementBlock("span",Ue,i.toDisplayString(s.errorMessage),1)):i.createCommentVNode("",!0)])):i.createCommentVNode("",!0)])}const je=k(Ee,[["render",He]]);x.PlayerWidget=z,x.RecorderWidget=je,Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});
